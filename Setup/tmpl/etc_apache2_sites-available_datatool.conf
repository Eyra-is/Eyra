<VirtualHost *:80>
	<If "req('Host') == '127.0.0.1'" >
		Redirect "/" "https://127.0.0.1/"
	</If>
	<ElseIf "req('Host') == 'localhost'" >
		Redirect "/" "https://localhost/"
	</ElseIf>
	<Else>
	        Redirect "/" "https://XXXHOST_NAMEXXX/"
	</Else>
</VirtualHost>

<IfModule mod_ssl.c>
	<VirtualHost *:443>
		ServerAdmin webmaster@localhost
		DocumentRoot XXXSITEROOTXXX

		<Directory XXXSITEROOTXXX>
			Options Indexes FollowSymLinks Includes ExecCGI
			AllowOverride All
			Require all granted
			Allow from all
		</Directory>

		SSLEngine on
		SSLCertificateFile	/etc/ssl/certs/ssl-cert-snakeoil.pem
		SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key
		
		<FilesMatch "\.(cgi|shtml|phtml|php)$">
				SSLOptions +StdEnvVars
		</FilesMatch>
		<Directory /usr/lib/cgi-bin>
				SSLOptions +StdEnvVars
		</Directory>
		
		BrowserMatch "MSIE [2-6]" \
				nokeepalive ssl-unclean-shutdown \
				downgrade-1.0 force-response-1.0
		BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown

		WSGIPassAuthorization On
		WSGIDaemonProcess ourapp user=XXXUSERXXX group=XXXGROUPXXX processes=XXXWSGI_NPROCXXX threads=XXXWSGI_NTHREADXXX
		WSGIProcessGroup ourapp
	
		# The Backend Stuff
		WSGIScriptAlias /backend XXXWSGIROOTXXX/backend.wsgi
		
		# Faking being online
		WSGIScriptAlias /generate_204 XXXWSGIROOTXXX/generate_204.wsgi
		
		# The WSGI directory
		<Directory XXXWSGIROOTXXX>
			Options Indexes FollowSymLinks Includes ExecCGI
			AllowOverride All
			Require all granted
			Allow from all
		</Directory>

		LogLevel info
		ErrorLog XXXLOGROOTXXX/error.log
		CustomLog XXXLOGROOTXXX/access.log combined

	</VirtualHost>
</IfModule>
